# MySQL高级


### 1. 存储引擎

##### 1.1. 对比MyISAM和InnoDB

| 对比项   | MyISAM                                                 | InnoDB                                                       |
| -------- | ------------------------------------------------------ | ------------------------------------------------------------ |
| 主外键   | 不支持                                                 | 支持                                                         |
| 事务     | 不支持                                                 | 支持                                                         |
| 行表锁   | 表锁,即使操作一条记录也会锁住整个表,不适合高并发的操作 | 行锁,操作时只锁一行,不对其他行有影响,适合高并发的操作        |
| 缓存     | 只缓存索引,不缓存真实数据                              | 不仅缓存索引还要缓存真实数据,对内存要求较高,而且内存大小对性能有决定性的影响 |
| 表空间   | 小                                                     | 大                                                           |
| 关注点   | 性能                                                   | 事务                                                         |
| 默认安装 | Y                                                      | Y                                                            |

##### 1.2. 阿里巴巴,淘宝用哪个?

| 产品           | 价格 | 目标                                     | 主要功能 | 是否可投入生产 |
| -------------- | ---- | ---------------------------------------- | -------- | -------------- |
| PerCona Server | 免费 | 提供XtraDB存储引擎的包装器和其他分析工具 | XtraDB   | 是             |
| MariaDB        | 免费 | 拓展MySQL以包含XtraDB和其他性能改进      | XtraDB   | 是             |
| Drizzle        | 免费 | 提供比MySQL更强大的可拓展性和性能改进    | 高可用性 | 是             |

* Percona为MySQL数据库服务器进行了改进,在功能和性能上较MySQL有着很显著的提升.该版本提升了在高负载情况下的InnoDB的性能,为DBA提供一些非常有用的性能诊断工具;另外有很多的参数和命令来控制服务器行为.
* 该公司新建了一款存储引擎交XtraDB完全可以替代InnoDB,并且在性能和并发上做的很好.
* 阿里巴巴大部分MySQL数据库其实使用的PerCona的原型加以修改.
* AliSql+AliRedis

### 2. 性能分析

##### 2.1. 性能下降SQL慢,执行时间长,等待时间长

* 查询语句写的烂
* 索引失效-单值,复合
* 关联查询太多join(设计缺陷或不得已的需求)
* 服务器调优及各个参数设置(缓冲,线程数等)

##### 2.2. 常见通用的join查询

* SQL执行顺序

  * 手写

    SELECT -> FROM -> WHERE -> GROUP BY -> HAVING -> ORDER BY -> LIMIT

  * 机读

    FROM -> ON -> WHERE -> GROUP BY -> HAVING -> SELECT -> DISTINCT -> ORDER BY -> LIMIT

  * 总结

    ![image-20220219160801991](/image-20220219160801991.png)

  

* JOIN图

​	![image-20220219161357380](/image-20220219161357380.png)

![image-20220219161428166](/image-20220219161428166.png)

##### 2.3. 索引简介

* 是什么?

  * MySQL官方对索引的定义为: 索引(Index)是帮助MySQL搞笑获取数据的数据结构.可以得到索引的本质: 索引是数据结构,索引的目的在于提高查询下效率,可以类比字典.

  * 你可以简单理解为"排好序的快速查找数据结构"

    1. 详解: 在数据之外,数据库系统还维护这满足特定查找算法的数据结构,这些数据结构以某种方式引用数据,这样就可以在这些数据结构上实现高级查找算法.这种数据结构就是索引,下图就是一种可能的索引方式示例:

    ![image-20220219163457059](/image-20220219163457059.png)

    为了加快Col2的查找,可以维护一个右边所示的二叉查找树,每个节点分别包含索引键值和一个指向对应数据记录物理地址的指针,这样就可以运用而查找树在一定的复杂度内获取到相应数据,从而快速的检索出复合条件的记录.

  * 一般来说索引本身也很大,不可能全部存储在内存中,因此索引往往以索引文件的形式存户磁盘上.

  * 我们平常所说的索引,如果没有特别指明,都是指B树(多路搜索树,并不一定是二叉的)结构组织的索引.其中聚集索引,次要索引,复合索引,前缀索引,唯一索引默认都是使用B+树索引,统称索引.当然,除了B+树这种类型的索引之外,还有哈希索引


